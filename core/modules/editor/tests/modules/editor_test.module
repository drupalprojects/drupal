<?php

/**
 * @file
 * Helper module for the Text Editor tests.
 */

use Drupal\filter\FilterFormatInterface;

/**
 * Implements HOOK_editor_default_settings().
 */
function editor_test_editor_default_settings($editor) {
  if ($editor === 'unicorn') {
    return array(
      'rainbows' => TRUE,
      'sparkles' => TRUE,
    );
  }
}

/**
 * Implements HOOK_editor_default_settings_alter().
 */
function editor_test_editor_default_settings_alter(&$settings, $editor) {
  if ($editor === 'unicorn' && isset($settings['sparkles'])) {
    $settings['sparkles'] = FALSE;
  }
}

/**
 * Implements HOOK_editor_js_settings_alter().
 */
function editor_test_editor_js_settings_alter(&$settings) {
  // Allow tests to enable or disable this alter hook.
  if (!\Drupal::state()->get('editor_test_js_settings_alter_enabled', FALSE)) {
    return;
  }

  if (isset($settings['editor']['formats']['full_html'])) {
    $settings['editor']['formats']['full_html']['editorSettings']['ponyModeEnabled'] = FALSE;
  }
}

/**
 * Implements HOOK_editor_xss_filter_alter().
 */
function editor_test_editor_xss_filter_alter(&$editor_xss_filter_class, FilterFormatInterface $format, FilterFormatInterface $original_format = NULL) {
  // Allow tests to enable or disable this alter hook.
  if (!\Drupal::state()->get('editor_test_editor_xss_filter_alter_enabled', FALSE)) {
    return;
  }

  $filters = $format->filters()->getAll();
  if (isset($filters['filter_html']) && $filters['filter_html']->status) {
    $editor_xss_filter_class = '\Drupal\editor_test\EditorXssFilter\Insecure';
  }
}
